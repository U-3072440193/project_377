{% extends 'base.html' %}
{% load static %}

{% block profile %}
<link rel="stylesheet" href="{% static 'styles/inbox.css' %}">
{% endblock %}

{% block content %}
<main class="profile">

    <div class="container-prof">

        <!-- Левый блок: аватар и профиль -->
        <div class="profile-left">
            <div class="profile-window">
                <h1>{{ profile.user.username }}</h1>
                <img src="{{ user.profile.avatar.url }}" alt="Аватар">
                <a href="{% url 'profile' %}" class="btn edit">Мой профиль</a>
            </div>
        </div>

        <!-- Правый блок: Inbox -->
        <div class="profile-right inbox">

            <h1>Почта</h1>
            <a href="{% url 'new-message' %}" class="btn compose">Написать сообщение</a>
            <h3>Непрочитанные: {{ unread }}</h3>

            <ul class="emails-list">
                {% for message in message_request %}
                <li class="email {% if not message.is_read %}email--unread{% endif %}">
                    <a href="{% url 'message' message.id %}">
                        <span class="email-name">{{ message.name }}</span>
                        <span class="email-subject">{{ message.subject }}</span>
                        <span class="email-date">{{ message.created }}</span>
                        <form method="post" action="{% url 'delete_message' message.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="delete-message">x</button>
                        </form>
                    </a>
                </li>
                {% endfor %}
            </ul>


        </div>

    </div>

</main>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Плавное удаление писем
    document.querySelectorAll('.delete-message').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            const emailItem = this.closest('.email');
            const form = this.closest('form');
            const messageId = form.action.split('/').filter(Boolean).pop();

            // Анимация удаления
            emailItem.classList.add('deleting');

            // Отправка формы после анимации
            setTimeout(() => {
                form.submit();
            }, 300);
        });
    });

    // Подсветка новых сообщений
    const unreadEmails = document.querySelectorAll('.email--unread');
    unreadEmails.forEach(email => {
        email.style.animationDelay = (Math.random() * 0.5) + 's';
    });


});
</script>
{% endblock %}
